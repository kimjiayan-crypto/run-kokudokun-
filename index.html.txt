<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åœ‹åœŸé–‹ç™¼ï¼šå·¥åœ°æ¥å¯¶å¤§ä½œæˆ°</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #87CEEB; /* å·¥åœ°è—å¤© */
            font-family: 'Arial', sans-serif;
            touch-action: none; /* ç¦æ­¢ç¸®æ”¾ */
        }

        /* å·¥åœ°èƒŒæ™¯è£é£¾ */
        #bg-decoration {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 20%;
            background: repeating-linear-gradient(
                45deg,
                #FFD700,
                #FFD700 10px,
                #333 10px,
                #333 20px
            );
            opacity: 0.5;
            z-index: -1;
        }

        #gameCanvas {
            display: block;
            width: 100%;
            height: 100vh;
        }

        /* UI ä»‹é¢ */
        .ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .hud {
            display: flex;
            justify-content: space-between;
            padding: 20px;
            font-size: 24px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 0 #000;
        }

        /* é–‹å§‹èˆ‡çµæŸç•«é¢ */
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 10;
            pointer-events: auto;
            text-align: center;
        }

        h1 {
            font-size: 32px;
            margin-bottom: 10px;
            color: #FFD700;
            text-shadow: 2px 2px 0 #000;
        }

        p {
            font-size: 18px;
            margin: 5px 20px;
            line-height: 1.5;
        }

        button {
            margin-top: 30px;
            padding: 15px 40px;
            font-size: 24px;
            border: none;
            border-radius: 50px;
            background: #FF4500;
            color: white;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 0 #B22222;
            transition: transform 0.1s;
        }

        button:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>

    <canvas id="gameCanvas"></canvas>
    <div id="bg-decoration"></div>

    <div class="ui-layer">
        <div class="hud">
            <span id="scoreDisplay">ğŸ’° åˆ†æ•¸: 0</span>
            <span id="timeDisplay">â±ï¸ 30</span>
        </div>
    </div>

    <div id="startScreen" class="overlay">
        <h1>ğŸ—ï¸ å·¥åœ°æ¥å¯¶å¤§ä½œæˆ°</h1>
        <p>å·¦å³å‚¾æ–œæ‰‹æ©Ÿä¾†æ§åˆ¶åœ‹åœŸé³¥</p>
        <p>æ¥ä½ç´…åŒ… ğŸ§§ (+100)</p>
        <p>é–ƒé¿é‹¼ç­‹èˆ‡èºçµ² ğŸ”© (-50)</p>
        <button id="startBtn">é–‹å§‹å·¥ä½œï¼</button>
        <p style="font-size: 12px; margin-top: 20px; color: #aaa;">(è‹¥ç„¡æ³•æ§åˆ¶ï¼Œè«‹æª¢æŸ¥æ‰‹æ©Ÿç€è¦½å™¨æ¬Šé™)</p>
    </div>

    <div id="gameOverScreen" class="overlay hidden">
        <h1>ğŸ‘· ä¸‹ç­å•¦ï¼</h1>
        <p>ä½ çš„æˆç¸¾</p>
        <h2 id="finalScore" style="font-size: 50px; color: #FFD700; margin: 10px 0;">0</h2>
        <button onclick="location.reload()">å†ç©ä¸€æ¬¡</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const timeDisplay = document.getElementById('timeDisplay');
        const startScreen = document.getElementById('startScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const finalScoreDisplay = document.getElementById('finalScore');
        const startBtn = document.getElementById('startBtn');

        // éŠæˆ²è¨­å®š
        let gameRunning = false;
        let score = 0;
        let timeLeft = 30;
        let spawnRate = 40; // æ‰è½ç‰©ç”Ÿæˆé »ç‡ (æ•¸å­—è¶Šå°è¶Šå¿«)
        let frameCount = 0;
        let difficultyMultiplier = 1; // é€Ÿåº¦å€ç‡

        // åœ–ç‰‡è³‡æº
        const playerImg = new Image();
        playerImg.src = 'åœ‹åœŸé³¥.png'; // âš ï¸ è«‹ç¢ºä¿æª”åä¸€è‡´ï¼Œæˆ–æ”¹ç‚º 'bird.png'
        let playerImgLoaded = false;
        playerImg.onload = () => { playerImgLoaded = true; };

        // ç©å®¶è¨­å®š
        const player = {
            x: 0,
            y: 0,
            width: 80,
            height: 80,
            speed: 0 // ç•¶å‰ç§»å‹•é€Ÿåº¦
        };

        // æ‰è½ç‰©é™£åˆ—
        let items = [];
        
        // æ‰è½ç‰©ç¨®é¡
        const itemTypes = [
            { type: 'good', emoji: 'ğŸ§§', score: 100, speed: 5 },
            { type: 'bad', emoji: 'ğŸ”©', score: -50, speed: 7 },
            { type: 'bad', emoji: 'ğŸ—ï¸', score: -50, speed: 8 },
            { type: 'bad', emoji: 'âš™ï¸', score: -50, speed: 6 }
        ];

        // åˆå§‹åŒ– Canvas å¤§å°
        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            player.y = canvas.height - player.height - 20;
            player.x = canvas.width / 2 - player.width / 2;
        }
        window.addEventListener('resize', resize);
        resize();

        // æ‰‹æ©Ÿå‚¾æ–œæ§åˆ¶
        function handleOrientation(event) {
            if (!gameRunning) return;
            
            // gamma æ˜¯å·¦å³å‚¾æ–œ (-90 åˆ° 90)
            const tilt = event.gamma; 
            
            // ç°¡å–®å¹³æ»‘è™•ç†ï¼šå°‡å‚¾æ–œè§’åº¦è½‰æ›ç‚ºé€Ÿåº¦
            if (tilt > 5) {
                player.speed = 8; // å‘å³
            } else if (tilt < -5) {
                player.speed = -8; // å‘å·¦
            } else {
                player.speed = 0; // åœæ­¢
            }
        }

        // é–‹å§‹æŒ‰éˆ• (è™•ç† iOS æ¬Šé™)
        startBtn.addEventListener('click', () => {
            // iOS 13+ éœ€è¦è«‹æ±‚æ¬Šé™
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission()
                    .then(response => {
                        if (response === 'granted') {
                            window.addEventListener('deviceorientation', handleOrientation);
                            startGame();
                        } else {
                            alert('éœ€è¦å…è¨±å‹•ä½œæ¬Šé™æ‰èƒ½ç©å–”ï¼');
                        }
                    })
                    .catch(console.error);
            } else {
                // Android æˆ–èˆŠç‰ˆ iOS
                window.addEventListener('deviceorientation', handleOrientation);
                startGame();
            }
        });

        // é›»è…¦ç‰ˆé™¤éŒ¯ç”¨ (éµç›¤æ§åˆ¶)
        window.addEventListener('keydown', (e) => {
            if (!gameRunning) return;
            if (e.key === 'ArrowLeft') player.x -= 20;
            if (e.key === 'ArrowRight') player.x += 20;
        });

        function startGame() {
            startScreen.classList.add('hidden');
            gameRunning = true;
            score = 0;
            timeLeft = 30;
            items = [];
            scoreDisplay.innerText = `ğŸ’° åˆ†æ•¸: ${score}`;
            
            // å•Ÿå‹•å€’æ•¸è¨ˆæ™‚
            const timerInterval = setInterval(() => {
                if (!gameRunning) {
                    clearInterval(timerInterval);
                    return;
                }
                timeLeft--;
                timeDisplay.innerText = `â±ï¸ ${timeLeft}`;

                // é›£åº¦å¢åŠ æ©Ÿåˆ¶
                if (timeLeft <= 15) {
                    difficultyMultiplier = 1.8; // æ™‚é–“å‰©ä¸€åŠï¼Œé€Ÿåº¦è®Šå¿«
                    spawnRate = 25; // ç”Ÿæˆè®Šå¿«
                    document.body.style.backgroundColor = "#FF7F50"; // èƒŒæ™¯è®Šè‰²è­¦ç¤º
                }

                if (timeLeft <= 0) {
                    endGame();
                    clearInterval(timerInterval);
                }
            }, 1000);

            requestAnimationFrame(gameLoop);
        }

        function endGame() {
            gameRunning = false;
            gameOverScreen.classList.remove('hidden');
            finalScoreDisplay.innerText = score;
        }

        function gameLoop() {
            if (!gameRunning) return;

            // æ¸…é™¤ç•«é¢
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // æ›´æ–°ç©å®¶ä½ç½®
            player.x += player.speed;
            
            // é‚Šç•Œæª¢æŸ¥
            if (player.x < 0) player.x = 0;
            if (player.x > canvas.width - player.width) player.x = canvas.width - player.width;

            // ç¹ªè£½ç©å®¶
            if (playerImgLoaded) {
                ctx.drawImage(playerImg, player.x, player.y, player.width, player.height);
            } else {
                // å¦‚æœè®€ä¸åˆ°åœ–ï¼Œç”¨ Emoji ä»£æ›¿
                ctx.font = '60px Arial';
                ctx.fillText('ğŸ¦', player.x + 10, player.y + 60);
            }

            // ç”Ÿæˆæ‰è½ç‰©
            frameCount++;
            if (frameCount % spawnRate === 0) {
                // éš¨æ©Ÿé¸ä¸€å€‹é¡å‹ï¼Œå¥½å£æ©Ÿç‡ (30% å¥½, 70% å£)
                const isGood = Math.random() > 0.6; 
                let itemType;
                
                if (isGood) {
                    itemType = itemTypes[0]; // ç´…åŒ…
                } else {
                    // éš¨æ©Ÿé¸ä¸€å€‹å£æ±è¥¿
                    itemType = itemTypes[Math.floor(Math.random() * (itemTypes.length - 1)) + 1];
                }

                items.push({
                    x: Math.random() * (canvas.width - 50),
                    y: -50,
                    ...itemType
                });
            }

            // æ›´æ–°ä¸¦ç¹ªè£½æ‰è½ç‰©
            for (let i = 0; i < items.length; i++) {
                let item = items[i];
                item.y += item.speed * difficultyMultiplier;

                // ç¹ªè£½ Emoji
                ctx.font = '40px Arial';
                ctx.fillText(item.emoji, item.x, item.y + 40);

                // ç¢°æ’åµæ¸¬ (ç°¡å–®çŸ©å½¢)
                if (
                    item.x < player.x + player.width &&
                    item.x + 40 > player.x &&
                    item.y < player.y + player.height &&
                    item.y + 40 > player.y
                ) {
                    // æ’åˆ°äº†ï¼
                    score += item.score;
                    scoreDisplay.innerText = `ğŸ’° åˆ†æ•¸: ${score}`;
                    
                    // è¦–è¦ºå›é¥‹ (ç°¡å–®é–ƒçˆ)
                    if (item.score < 0) {
                        canvas.style.opacity = 0.5;
                        setTimeout(() => canvas.style.opacity = 1, 100);
                    }

                    // ç§»é™¤è©²ç‰©ä»¶
                    items.splice(i, 1);
                    i--;
                    continue;
                }

                // è¶…å‡ºåº•éƒ¨ç§»é™¤
                if (item.y > canvas.height) {
                    items.splice(i, 1);
                    i--;
                }
            }

            requestAnimationFrame(gameLoop);
        }
    </script>
</body>
</html>